{# templates/comments/_comment.html #}
{% load i18n %}

<li class="mb-3" id="comment-{{ comment.id }}">
  <p>
    <strong>{{ comment.author.username }}</strong>
    — {{ comment.created_at|date:"SHORT_DATETIME_FORMAT" }}
  </p>
  <p>{{ comment.content }}</p>

  <!-- Форма ответа -->
  <form method="post" class="reply-form mb-2">
    {% csrf_token %}
    <input type="hidden" name="parent_id" value="{{ comment.id }}">
    <textarea name="content"
              class="form-control mb-1"
              rows="2"
              placeholder="{% trans 'Reply...' %}"></textarea>
    <button type="submit" class="btn btn-sm btn-outline-primary">
      {% trans "Reply" %}
    </button>
  </form>

  <!-- Дети -->
  {% if comment.replies.exists %}
    <ul class="ms-4 list-unstyled">
      {% for reply in comment.replies.all %}
        {# ✅ рекурсивно подключаем тот же шаблон #}
        {% include "comments/_comment.html" with comment=reply %}
      {% endfor %}
    </ul>
  {% endif %}
</li>
