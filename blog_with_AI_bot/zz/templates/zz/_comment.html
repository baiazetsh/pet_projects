<!-- _comment.html -->
{# templates/zz/_comment.html #}
{% load i18n %}
{% load static %}

<li id="comment-{{ comment.id }}" class="transition-all duration-500 ease-in-out animate-fade-in mb-3">
  <div class="d-flex align-items-center mb-1">
    <!-- 🔥 аватар + имя автора -->
    <img src="{{ comment.author.profile.avatar_url }}"
         class="rounded-circle me-2 avatar-click avatar-img"
         alt="avatar"
         width="32" height="32"
         data-profile-id="{{ comment.author.profile.pk }}"
         onerror="this.src='{% static 'images/default-avatar.png' %}'">
    <!-- 🔥 конец блока аватара -->

    <div>
      <strong>{{ comment.author.profile.display_name }}</strong>
      <small class="text-muted ms-2">{{ comment.created_at|date:"SHORT_DATETIME_FORMAT" }}</small>
    </div>
  </div>

  
  
    {% if comment.parent %}
      <div class="text-muted mb-1">   
        <small><em>
          {{ comment.parent.profile.display_name }}  
          {{ comment.parent.content|truncatechars:50 }}
        </em></small>  
      </div> 
    {% elif comment.parent_id %}
      <div class="text-muted mb-1">
        <small><em>
          {% trans "Quote was deleted" %}
        </em></small>  
      </div>
    {%  endif %}

    <p>{{ comment.content }}</p>

  <!-- Reply form -->
  <form method="post" class="reply-form mt-2">
    {% csrf_token %}
    <input type="hidden" name="parent_id" value="{{ comment.id }}">
    <textarea name="content"
              class="form-control mb-2"
              rows="2"
              placeholder="{% trans 'Reply...' %}"></textarea>
    <button type="submit" class="btn btn-primary btn-sm ">
      {% trans "Reply" %}
    </button>
  </form>

  <!-- Nested replies -->
  {% if comment.replies.exists %}
    <ul class="list-unstyled ms-4 mt-3">
      {% for reply in comment.replies.all %}
        {% include "zz/_comment.html" with comment=reply %}
      {% endfor %}
    </ul>
  {% endif %}



</li>